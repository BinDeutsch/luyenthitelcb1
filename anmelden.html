<!DOCTYPE html>
<html lang="vi">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Bin Deutsch - Secure Access</title>
    <link href="https://fonts.googleapis.com/css2?family=Plus+Jakarta+Sans:wght@400;500;600;700&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <style>
        :root {
            --primary: #4f46e5;
            --accent: #6366f1;
            --bg: #0f172a;
            --glass: rgba(30, 41, 59, 0.7);
            --border: rgba(255, 255, 255, 0.1);
        }

        * { box-sizing: border-box; margin: 0; padding: 0; font-family: 'Plus Jakarta Sans', sans-serif; }
        
        body {
            background: radial-gradient(circle at top left, #1e1b4b, #0f172a);
            color: white; min-height: 100vh; display: flex; align-items: center; justify-content: center;
        }

        .container {
            width: 1000px; height: 600px; display: flex;
            background: var(--glass); backdrop-filter: blur(20px);
            border-radius: 24px; border: 1px solid var(--border); overflow: hidden;
            box-shadow: 0 25px 50px -12px rgba(0, 0, 0, 0.5);
        }

        /* Bên trái - Info */
        .info-side {
            flex: 1.2; padding: 60px; display: flex; flex-direction: column;
            background: linear-gradient(135deg, rgba(79, 70, 229, 0.1), transparent);
            border-right: 1px solid var(--border);
        }

        .brand { color: #6366f1; font-weight: 800; font-size: 22px; margin-bottom: 60px; display: flex; align-items: center; gap: 10px; }
        .secure-tag { color: #10b981; font-size: 12px; font-weight: 700; letter-spacing: 1px; margin-bottom: 20px; text-transform: uppercase; }
        .info-side h1 { font-size: 42px; font-weight: 700; line-height: 1.2; margin-bottom: 30px; }
        
        .features { list-style: none; }
        .features li { display: flex; align-items: center; gap: 15px; margin-bottom: 20px; color: #cbd5e1; font-size: 15px; }
        .features li i { color: #6366f1; background: rgba(99, 102, 241, 0.1); padding: 8px; border-radius: 50%; font-size: 12px; }

        .footer-text { margin-top: auto; color: #64748b; font-size: 12px; }

        /* Bên phải - Form */
        .form-side { flex: 1; padding: 60px; display: flex; flex-direction: column; justify-content: center; position: relative; }
        
        .hidden { display: none !important; }
        h2 { font-size: 28px; margin-bottom: 10px; }
        .sub-text { color: #94a3b8; font-size: 14px; margin-bottom: 35px; }

        .input-group { position: relative; margin-bottom: 18px; }
        .input-group i { position: absolute; left: 18px; top: 50%; transform: translateY(-50%); color: #64748b; font-size: 18px; }
        input {
            width: 100%; background: rgba(15, 23, 42, 0.6); border: 1px solid var(--border);
            padding: 16px 16px 16px 50px; border-radius: 14px; color: white; outline: none; transition: 0.3s;
        }
        input:focus { border-color: var(--primary); box-shadow: 0 0 0 4px rgba(79, 70, 229, 0.1); }

        .btn {
            width: 100%; padding: 16px; border-radius: 14px; border: none; font-weight: 600; font-size: 15px;
            cursor: pointer; transition: 0.3s; margin-top: 10px; display: flex; align-items: center; justify-content: center; gap: 10px;
        }
        .btn-primary { background: var(--primary); color: white; }
        .btn-primary:hover { background: var(--accent); transform: translateY(-2px); }
        .btn-secondary { background: #10b981; color: #000; font-weight: 700; }

        .switch-link { text-align: center; margin-top: 25px; font-size: 14px; color: #94a3b8; }
        .switch-link span { color: #6366f1; cursor: pointer; font-weight: 600; }

        /* QR Section */
        .qr-area { text-align: center; }
        .qr-box { background: white; padding: 10px; border-radius: 15px; width: 150px; margin: 0 auto 20px; }
        .qr-box img { width: 100%; display: block; }
        .bill-info { background: rgba(0,0,0,0.2); border-radius: 12px; padding: 15px; margin-bottom: 20px; font-size: 13px; text-align: left; }
        .bill-info div { display: flex; justify-content: space-between; margin-bottom: 5px; }
        .bill-info b { color: #10b981; }

    </style>
</head>
<body>

<div class="container">
    <div class="info-side">
        <div class="brand"><i class="fas fa-paper-plane"></i> BIN DEUTSCH</div>
        <div class="secure-tag" id="status-badge">Secure Access</div>
        <h1>Luyện thi Telc B1<br>thông minh.</h1>
        <ul class="features">
            <li><i class="fas fa-check"></i> AI phân tích lỗi sai bài đọc</li>
            <li><i class="fas fa-check"></i> Kho đề thi cập nhật 2026</li>
            <li><i class="fas fa-check"></i> Khóa học vĩnh viễn trên 1 máy</li>
        </ul>
        <div class="footer-text">© 2026 Hệ thống được phát triển bới Bin Deutsch.</div>
    </div>

    <div class="form-side">
        <div id="step-register">
            <h2>Đăng ký mới</h2>
            <p class="sub-text">Bắt đầu hành trình chinh phục Telc B1 ngay hôm nay.</p>
            <div class="input-group">
                <i class="far fa-user"></i>
                <input type="text" id="reg-u" placeholder="Tên đăng nhập">
            </div>
            <div class="input-group">
                <i class="fas fa-lock"></i>
                <input type="password" id="reg-p" placeholder="Mật khẩu bảo mật">
            </div>
            <button class="btn btn-primary" onclick="goRegister()">Tiếp tục đăng ký →</button>
            <p class="switch-link">Bạn đã có tài khoản? <span onclick="showUI('step-login')">Đăng nhập</span></p>
        </div>

        <div id="step-pay" class="hidden qr-area">
            <h2>Kích hoạt khóa học</h2>
            <p class="sub-text">Quét mã để nhận Key kích hoạt tự động.</p>
            <div class="qr-box">
                <img id="qr-img" src="" alt="QR">
            </div>
            <div class="bill-info">
                <div><span>Số tiền:</span> <b>149.000đ</b></div>
                <div><span>Nội dung:</span> <b id="pay-content"></b></div>
            </div>
            <div class="input-group">
                <i class="fas fa-key"></i>
                <input type="text" id="key-input" placeholder="Nhập mã kích hoạt của bạn">
            </div>
            <button class="btn btn-secondary" onclick="goActivate()">Kích hoạt ngay</button>
        </div>

        <div id="step-login" class="hidden">
            <h2>Chào bạn quay lại</h2>
            <p class="sub-text">Đăng nhập để tiếp tục việc học của bạn.</p>
            <div class="input-group">
                <i class="far fa-user"></i>
                <input type="text" id="log-u" placeholder="Tên đăng nhập">
            </div>
            <div class="input-group">
                <i class="fas fa-lock"></i>
                <input type="password" id="log-p" placeholder="Mật khẩu">
            </div>
            <button class="btn btn-primary" onclick="goLogin()">Đăng nhập ngay</button>
            <p class="switch-link">Chưa có tài khoản? <span onclick="showUI('step-register')">Đăng ký mới</span></p>
        </div>
    </div>
</div>

<script src="https://www.gstatic.com/firebasejs/8.10.0/firebase-app.js"></script>
<script src="https://www.gstatic.com/firebasejs/8.10.0/firebase-firestore.js"></script>

<script>
    const firebaseConfig = {
        apiKey: "AIzaSyBUPyMLemOPc2PxcUEL7idiWexFZvVVsjs",
        authDomain: "telc-b1-ai.firebaseapp.com",
        projectId: "telc-b1-ai",
        storageBucket: "telc-b1-ai.firebasestorage.app",
        messagingSenderId: "992197424488",
        appId: "1:992197424488:web:d02815a8c95ee27ae0d2dd"
    };
    firebase.initializeApp(firebaseConfig);
    const db = firebase.firestore();
    const COLLECTION = "member"; // Tên collection trên Firebase của bạn

    function showUI(id) {
        document.getElementById('step-register').classList.add('hidden');
        document.getElementById('step-pay').classList.add('hidden');
        document.getElementById('step-login').classList.add('hidden');
        document.getElementById(id).classList.remove('hidden');
    }

    // Xử lý Đăng ký
    function goRegister() {
        const u = document.getElementById('reg-u').value.trim();
        const p = document.getElementById('reg-p').value.trim();
        if(!u || !p) return alert("Vui lòng nhập đủ thông tin!");

        sessionStorage.setItem('temp_u', u);
        sessionStorage.setItem('temp_p', p);

        const content = "BIN" + u.toUpperCase();
        document.getElementById('pay-content').innerText = content;
        document.getElementById('qr-img').src = `https://img.vietqr.io/image/MB-0348307488-compact2.png?amount=149000&addInfo=${content}`;

        showUI('step-pay');
        document.getElementById('status-badge').innerText = "⚡ Đang chờ kích hoạt";
        document.getElementById('status-badge').style.color = "#f59e0b";
    }

    // Xử lý Kích hoạt
    async function goActivate() {
        const key = document.getElementById('key-input').value.trim();
        const u = sessionStorage.getItem('temp_u');
        const p = sessionStorage.getItem('temp_p');

        if(!key) return alert("Nhập mã kích hoạt!");

        try {
            const snap = await db.collection(COLLECTION).where('memberCode', '==', key).where('isUsed', '==', false).get();
            if(snap.empty) return alert("Mã không đúng hoặc đã bị dùng!");

            const devId = 'ID-' + Math.random().toString(36).substr(2, 9);
            await db.collection(COLLECTION).doc(snap.docs[0].id).update({
                username: u, password: p, deviceId: devId, isUsed: true
            });

            localStorage.setItem('my_dev_id', devId);
            alert("Kích hoạt thành công!");
            showUI('step-login');
        } catch (e) { alert("Lỗi hệ thống!"); }
    }

    // Xử lý Đăng nhập
    async function goLogin() {
        const u = document.getElementById('log-u').value.trim();
        const p = document.getElementById('log-p').value.trim();
        const myDev = localStorage.getItem('my_dev_id');

        try {
            const snap = await db.collection(COLLECTION).where('username', '==', u).where('password', '==', p).get();
            if(!snap.empty) {
                if(snap.docs[0].data().deviceId === myDev) {
                    window.location.href = "index.html";
                } else { alert("Tài khoản này thuộc về thiết bị khác!"); }
            } else { alert("Sai tài khoản hoặc mật khẩu!"); }
        } catch (e) { alert("Lỗi kết nối!"); }
    }

    window.onload = () => { if(localStorage.getItem('my_dev_id')) showUI('step-login'); };
</script>
</body>
</html>