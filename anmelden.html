<!DOCTYPE html>
<html lang="vi">
<head>

    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Bin Deutsch - Luy·ªán Thi Telc B1</title>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;600;700&display=swap" rel="stylesheet">
	    <style>
        :root {
            --bg: #050505;
            --card: #111111;
            --input: #1a1a1a;
            --blue: #2563eb;
            --green: #10b981;
            --text: #ffffff;
            --border: #222222;
        }

        * { box-sizing: border-box; margin: 0; padding: 0; }
        body {
            font-family: 'Inter', sans-serif;
            background-color: var(--bg);
            color: var(--text);
            display: flex; justify-content: center; align-items: center; min-height: 100vh;
        }

        .app-container {
            background-color: var(--card);
            width: 950px; height: 580px;
            border-radius: 20px; display: flex;
            border: 1px solid var(--border); overflow: hidden;
            box-shadow: 0 40px 100px rgba(0,0,0,0.8);
        }

        .info-panel {
            flex: 1; padding: 60px;
            display: flex; flex-direction: column; justify-content: center;
            border-right: 1px solid var(--border);
            background: radial-gradient(circle at top left, #1a1a1a, #111111);
        }

        .badge { color: var(--green); font-size: 13px; font-weight: 700; margin-bottom: 20px; }
        .info-panel h1 { font-size: 38px; line-height: 1.1; margin-bottom: 20px; }
        .info-panel p { color: #888; font-size: 16px; }

        .form-panel {
            flex: 1; padding: 50px;
            display: flex; flex-direction: column; justify-content: center;
            background-color: #0c0c0c;
        }

        .hidden { display: none !important; }

        input {
            width: 100%; padding: 15px; margin-bottom: 15px;
            background-color: var(--input); border: 1px solid var(--border);
            border-radius: 12px; color: white; outline: none;
        }
        input:focus { border-color: var(--blue); }

        .btn {
            width: 100%; padding: 16px; border: none; border-radius: 12px;
            font-weight: 700; cursor: pointer; transition: 0.3s;
        }
        .btn-blue { background-color: var(--blue); color: white; }
        .btn-green { background-color: var(--green); color: black; margin-top: 10px; }

        .qr-display { background: white; padding: 10px; border-radius: 16px; width: 160px; margin: 0 auto 15px; }
        .qr-display img { width: 100%; display: block; }
        .bill-box { background: #151515; padding: 15px; border-radius: 12px; margin-bottom: 15px; border: 1px solid #222; font-size: 14px; }
        .bill-row { display: flex; justify-content: space-between; margin-bottom: 5px; }
        .bill-row b { color: var(--green); }
    </style>
</head>
<body>

<div class="app-container">
    <div class="info-panel">
        <div id="left-badge" class="badge">‚ö° ƒêANG CH·ªú ƒêƒÇNG K√ù</div>
        <h1>Luy·ªán thi Telc B1<br>Chu·∫©n 100% Th·ª±c T·∫ø</h1>
        <p>H·ªá th·ªëng th√¥ng minh v·∫≠n h√†nh b·ªüi Bin Deutsch.</p>
        <p style="margin-top: 20px; font-size: 12px; color: #444;">¬© 2026 Bin Deutsch System</p>
    </div>

    <div class="form-panel">
        <div id="ui-register">
            <h2 style="margin-bottom: 30px; text-align: center;">T·∫°o t√†i kho·∫£n m·ªõi</h2>
            <input type="text" id="u" placeholder="T√™n ƒëƒÉng nh·∫≠p">
            <input type="password" id="p" placeholder="M·∫≠t kh·∫©u">
            <button class="btn btn-blue" onclick="actionRegister()">ƒêƒÉng k√Ω t√†i kho·∫£n</button>
        </div>

        <div id="ui-payment" class="hidden">
            <p style="text-align: center; font-size: 13px; margin-bottom: 10px; color: #888;">Qu√©t m√£ thanh to√°n 149.000ƒë</p>
            <div class="qr-display">
                <img id="qr-code" src="" alt="QR">
            </div>
            <div class="bill-box">
                <div class="bill-row"><span>S·ªë ti·ªÅn:</span> <b>149.000ƒë</b></div>
                <div class="bill-row"><span>N·ªôi dung:</span> <b id="pay-msg"></b></div>
            </div>
            <input type="text" id="key-code" placeholder="Nh·∫≠p m√£ k√≠ch ho·∫°t...">
            <button class="btn btn-green" onclick="actionActivate()">K√≠ch ho·∫°t ngay</button>
        </div>

        <div id="ui-login" class="hidden">
            <h2 style="margin-bottom: 30px; text-align: center;">ƒêƒÉng nh·∫≠p</h2>
            <input type="text" id="log-u" placeholder="T√™n ƒëƒÉng nh·∫≠p">
            <input type="password" id="log-p" placeholder="M·∫≠t kh·∫©u">
            <button class="btn btn-blue" onclick="actionLogin()">V√†o h·ªçc ngay</button>
        </div>
    </div>
</div>

<script src="https://www.gstatic.com/firebasejs/8.10.0/firebase-app.js"></script>
<script src="https://www.gstatic.com/firebasejs/8.10.0/firebase-firestore.js"></script>

<script>
    // 1. C·∫•u h√¨nh Firebase
    // 1. C·∫•u h√¨nh Firebase
const firebaseConfig = {
    apiKey: "AIzaSyBUPyMLemOPc2PxcUEL7idiWexFZvVVsjs",
    authDomain: "telc-b1-ai.firebaseapp.com",
    projectId: "telc-b1-ai",
    storageBucket: "telc-b1-ai.firebasestorage.app",
    messagingSenderId: "992197424488",
    appId: "1:992197424488:web:d02815a8c95ee27ae0d2dd"
};
firebase.initializeApp(firebaseConfig);
const db = firebase.firestore();

// QUAN TR·ªåNG: Ki·ªÉm tra l·∫°i t√™n n√†y tr√™n Firebase c·ªßa b·∫°n (users hay member?)
const COLLECTION_NAME = "member"; 

function switchUI(id) {
    document.getElementById('ui-register').classList.add('hidden');
    document.getElementById('ui-payment').classList.add('hidden');
    document.getElementById('ui-login').classList.add('hidden');
    document.getElementById(id).classList.remove('hidden');
}

// --- H√ÄM ƒêƒÇNG K√ù ---
function actionRegister() {
    const user = document.getElementById('u').value.trim();
    const pass = document.getElementById('p').value.trim();

    if (!user || !pass) return alert("Vui l√≤ng nh·∫≠p ƒë·ªß th√¥ng tin!");

    sessionStorage.setItem('temp_u', user);
    sessionStorage.setItem('temp_p', pass);

    const content = "BIN" + user.toUpperCase();
    document.getElementById('pay-msg').innerText = content;
    document.getElementById('qr-code').src = `https://img.vietqr.io/image/MB-0348307488-compact2.png?amount=149000&addInfo=${encodeURIComponent(content)}`;

    switchUI('ui-payment');
    document.getElementById('left-badge').innerText = "‚ö° ƒêƒÇNG K√ù TH√ÄNH C√îNG";
}

// --- H√ÄM K√çCH HO·∫†T ---
async function actionActivate() {
    const keyInput = document.getElementById('key-code').value.trim();
    const user = sessionStorage.getItem('temp_u');
    const pass = sessionStorage.getItem('temp_p');

    if (!user) return alert("L·ªói: Vui l√≤ng ƒëƒÉng k√Ω l·∫°i!");
    if (!keyInput) return alert("H√£y nh·∫≠p m√£ Key!");

    try {
        const snap = await db.collection(COLLECTION_NAME).where('memberCode', '==', keyInput).where('isUsed', '==', false).get();

        if (snap.empty) return alert("Key sai ho·∫∑c ƒë√£ b·ªã d√πng!");

        const devId = 'ID-' + Math.random().toString(36).substr(2, 9);
        await db.collection(COLLECTION_NAME).doc(snap.docs[0].id).update({
            username: user,
            password: pass,
            deviceId: devId,
            isUsed: true
        });

        localStorage.setItem('my_dev_id', devId);
        alert("üéâ K√≠ch ho·∫°t th√†nh c√¥ng!");
        switchUI('ui-login');
    } catch (e) { alert("L·ªói Firebase: " + e.message); }
}

// --- H√ÄM ƒêƒÇNG NH·∫¨P (ƒê√É FIX L·ªñI SAI TH√îNG TIN) ---
async function actionLogin() {
    const u = document.getElementById('log-u').value.trim();
    const p = document.getElementById('log-p').value.trim();
    const myDev = localStorage.getItem('my_dev_id');

    try {
        const snap = await db.collection(COLLECTION_NAME)
            .where('username', '==', u)
            .where('password', '==', p)
            .get();

        if (!snap.empty) {
            const userData = snap.docs[0].data();
            if (userData.deviceId === myDev) {
                // QUAN TR·ªåNG: L∆∞u tr·∫°ng th√°i ƒëƒÉng nh·∫≠p v√†o m√°y
                localStorage.setItem('user_session', 'active'); 
                alert("üéâ ƒêƒÉng nh·∫≠p th√†nh c√¥ng!");
                window.location.replace("index.html"); // D√πng replace ƒë·ªÉ kh√¥ng quay l·∫°i ƒë∆∞·ª£c trang login b·∫±ng n√∫t Back
            } else {
                alert("‚ùå Thi·∫øt b·ªã n√†y kh√¥ng ƒë∆∞·ª£c ph√©p!");
            }
        } else {
            alert("‚ùå Sai t√†i kho·∫£n ho·∫∑c m·∫≠t kh·∫©u!");
        }
    } catch (e) { alert("L·ªói: " + e.message); }
}

window.onload = () => {
    const myDev = localStorage.getItem('my_dev_id');
    const isLoggedIn = sessionStorage.getItem('isLoggedIn');

    // N·∫øu ƒë√£ k√≠ch ho·∫°t m√°y V√Ä ch∆∞a ƒëƒÉng nh·∫≠p th√†nh c√¥ng th√¨ m·ªõi hi·ªán Login
    if (myDev && !isLoggedIn) {
        switchUI('ui-login');
    } 
    // N·∫øu ƒë√£ ƒëƒÉng nh·∫≠p r·ªìi m√† v·∫´n ·ªü trang login.html th√¨ chuy·ªÉn sang index.html lu√¥n
    else if (myDev && isLoggedIn && window.location.pathname.includes('login.html')) {
        window.location.href = "index.html";
    }
};
</script>
</body>
</html>